<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:m="using:AvaloniaTest.DataModel"
             xmlns:vm="using:AvaloniaTest.ViewModels"
             xmlns:c="using:AvaloniaTest.Converters"
             xmlns:v="using:AvaloniaTest.Views"
             xmlns:conv="using:AvaloniaTest.Converters"
             xmlns:local="clr-namespace:AvaloniaTest.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="30"
             x:Class="AvaloniaTest.Views.TabBarView"
             x:DataType="vm:MainWindowViewModel"
             x:Name="MainTabBar">
  
  <UserControl.Resources>
    <local:IconKeyToGeometryConverter x:Key="IconKeyConverter"/>
  </UserControl.Resources>
  <UserControl.DataContext>
    <vm:MainWindowViewModel/>
  </UserControl.DataContext>
    
  <UserControl.Styles>
    <Style Selector="Path#CloseTabPath">
      <Setter Property="Opacity" Value="0"></Setter>
    </Style>
    <Style Selector="ListBoxItem:selected Path#CloseTabPath">
      <Setter Property="Opacity" Value="1"></Setter>
    </Style>
    <Style Selector="ListBoxItem:pointerover Path#CloseTabPath">
      <Setter Property="Opacity" Value="1"></Setter>
    </Style>
    
  </UserControl.Styles>
  <Grid ColumnDefinitions="Auto,*,Auto">
    <RepeatButton Grid.Column="0"
                  Classes="icon_button"
                  Width="18" Height="30"
                  Click="ScrollTabsLeft"
                  IsVisible="{Binding #MainTabBar.IsScrollerVisible}">
      <!-- <Path Width="8" Height="14" Stretch="Fill" Data="{StaticResource Icons.TriangleLeft}"/> -->
      <Button Width="8" Height="14">L</Button>
    </RepeatButton>

    <ScrollViewer Grid.Column="1"
                  Margin="6,0"
                  x:Name="LauncherTabsScroller"
                  HorizontalAlignment="Left"
                  HorizontalScrollBarVisibility="Hidden"
                  VerticalScrollBarVisibility="Disabled"
                  PointerWheelChanged="ScrollTabs">
      <StackPanel Orientation="Horizontal">
        <ListBox x:Name="LauncherTabsList"
                 Classes="launcher_page_tabbar"
                 ItemsSource="{Binding Pages}"
                 SelectionMode="AlwaysSelected"
                 SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                 SelectionChanged="OnTabsSelectionChanged"
                 LayoutUpdated="OnTabsLayoutUpdated">
          <ListBox.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Orientation="Horizontal" Height="30"/>
            </ItemsPanelTemplate>
          </ListBox.ItemsPanel>

          <ListBox.ItemTemplate>
            <DataTemplate DataType="vm:EditorPageViewModel">
              <Border Height="30"
                      Background="Transparent"
                      PointerPressed="OnPointerPressedTab"
                      PointerMoved="OnPointerMovedOverTab"
                      PointerReleased="OnPointerReleasedTab"
                      Loaded="SetupDragAndDrop"
                      ContextRequested="OnTabContextRequested">
                <ToolTip.Tip>
                  <Grid>
                    <!-- <TextBlock Text="{DynamicResource Text.Welcome}" IsVisible="{Binding !Node.IsRepository}"/> -->
                    <!-- <StackPanel Orientation="Horizontal" IsVisible="{Binding Node.IsRepository}"> -->
                    <StackPanel Orientation="Horizontal">
                      <TextBlock>Test</TextBlock>
                      <!-- <TextBlock Text="{Binding Node.Id}"/> -->
                      <!-- <TextBlock Text="{Binding DirtyState, Converter={x:Static c:DirtyStateConverters.ToDesc}}" -->
                      <!--            Foreground="{DynamicResource Brush.FG2}"/> -->
                    </StackPanel>
                  </Grid>
                </ToolTip.Tip>

                <!-- <Grid Width="{Binding Source={x:Static vm:Preferences.Instance}, Path=UseFixedTabWidth, Converter={x:Static c:BoolConverters.ToPageTabWidth}}" Height="30" ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center"> -->
                  <Grid Width="200" Height="30" ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
                  <Path Grid.Column="0"
                        Width="12" Height="12" Margin="12,0"
                        Data="{Binding Icon, Converter={StaticResource IconKeyConverter}}"
                        IsVisible="{Binding Icon, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                        IsHitTestVisible="False"/>
                  <!-- <Path Grid.Column="0" -->
                  <!--       Width="12" Height="12" Margin="12,0" -->
                  <!--       Fill="{DynamicResource Brush.FG1}" -->
                  <!--       Data="{StaticResource Icons.Repositories}" -->
                  <!--       IsVisible="{Binding !Node.IsRepository}" -->
                  <!--       IsHitTestVisible="False"/> -->

                  <!-- <Grid Grid.Column="1" -->
                  <!--       HorizontalAlignment="Center" VerticalAlignment="Center" -->
                  <!--       ColumnDefinitions="Auto,*" -->
                  <!--       IsHitTestVisible="False" -->
                  <!--       IsVisible="{Binding Node.IsRepository}"> -->
                    <Grid Grid.Column="1"
                          HorizontalAlignment="Center" VerticalAlignment="Center"
                          ColumnDefinitions="Auto,*"
                          IsHitTestVisible="False">
                    <!-- <Ellipse Grid.Column="0" -->
                    <!--          Width="8" Height="8" -->
                    <!--          Margin="0,0,6,0" -->
                    <!--          VerticalAlignment="Center" -->
                    <!--          IsVisible="{Binding DirtyState, Converter={x:Static ObjectConverters.IsNotNull}, ConverterParameter={x:Static m:DirtyState.None}}" -->
                    <!--          Fill="{Binding DirtyState, Converter={x:Static c:DirtyStateConverters.ToBrush}}"/> -->

                    <!-- <TextBlock Grid.Column="1" -->
                    <!--            Classes="primary" -->
                    <!--            VerticalAlignment="Center" -->
                    <!--            FontSize="{Binding Source={x:Static vm:Preferences.Instance}, Path=DefaultFontSize, Converter={x:Static c:DoubleConverters.Decrease}}" -->
                    <!--            TextAlignment="Center" -->
                    <!--            Text="{Binding Node.Name}" -->
                    <!--            IsHitTestVisible="False"/> -->
                    
                    <TextBlock Grid.Column="1"
                               Classes="primary"
                               Padding="6 0 0 0"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               FontSize="12"
                               TextAlignment="Center"
                               Text="{Binding Title}"
                               IsHitTestVisible="False"/>
                  </Grid>

                  <!-- <TextBlock Grid.Column="1" -->
                  <!--            Classes="primary" -->
                  <!--            HorizontalAlignment="Stretch" VerticalAlignment="Center" -->
                  <!--            FontSize="{Binding Source={x:Static vm:Preferences.Instance}, Path=DefaultFontSize, Converter={x:Static c:DoubleConverters.Decrease}}" -->
                  <!--            TextAlignment="Center" -->
                  <!--            Text="{DynamicResource Text.PageTabBar.Welcome.Title}" -->
                  <!--            IsVisible="{Binding !Node.IsRepository}" -->
                  <!--            IsHitTestVisible="False"/> -->

                  
                  <Ellipse Grid.Column="2"
                           Width="8" Height="8"
                           Margin="16,0,0,0"
                           VerticalAlignment="Center"
                           IsVisible="{Binding Modified}"
                           Fill="Gray"/>
                  <Button Grid.Column="2"
                          Classes="icon_button"
                          Width="16" Height="16" Margin="12,0"
                          Click="OnCloseTab">
                    <ToolTip.Tip>
                      <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{DynamicResource Text.PageTabBar.Tab.Close}" VerticalAlignment="Center"/>
                        <TextBlock Margin="16,0,0,0"
                                   Text="{OnPlatform Ctrl+W, macOS=âŒ˜+W}"
                                   FontSize="11"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource MenuFlyoutItemKeyboardAcceleratorTextForeground}"/>
                      </StackPanel>
                    </ToolTip.Tip>
                    <Path x:Name="CloseTabPath" Width="9" Height="9" Data="{StaticResource Icons.Close}"/>
                  </Button>
                </Grid>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>

        <Button Classes="icon_button"
                Width="16" Height="16"
                Margin="8,0"
                Command="{Binding AddNewTab}"
                IsVisible="{Binding !#MainTabBar.IsScrollerVisible}">
          <ToolTip.Tip>
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
              <TextBlock Text="{DynamicResource Text.PageTabBar.New}" VerticalAlignment="Center"/>
              <TextBlock Margin="16,0,0,0"
                         Text="{OnPlatform Ctrl+T, macOS=âŒ˜+T}"
                         FontSize="11"
                         VerticalAlignment="Center"
                         Foreground="{DynamicResource MenuFlyoutItemKeyboardAcceleratorTextForeground}"/>
            </StackPanel>
          </ToolTip.Tip>

          <Path Width="12" Height="12" Data="{StaticResource Icons.Plus}"/>
        </Button>
      </StackPanel>
    </ScrollViewer>

    <StackPanel Grid.Column="2" Orientation="Horizontal" IsVisible="{Binding #MainTabBar.IsScrollerVisible}">
      <RepeatButton Classes="icon_button" Width="18" Height="30" Click="ScrollTabsRight">
        <Button Width="8" Height="14">R</Button>
        <!-- <Path Width="8" Height="14" Stretch="Fill" Data="{StaticResource Icons.TriangleRight}"/> -->
      </RepeatButton>

      <!-- <Button Classes="icon_button" Width="16" Height="16" Margin="4,0,0,0" Command="{Binding AddNewTab}"> -->
      <!--   <ToolTip.Tip> -->
      <!--     <StackPanel Orientation="Horizontal" VerticalAlignment="Center"> -->
      <!--       <TextBlock Text="{DynamicResource Text.PageTabBar.New}" VerticalAlignment="Center"/> -->
      <!--       <TextBlock Margin="16,0,0,0" -->
      <!--                  Text="{OnPlatform Ctrl+T, macOS=âŒ˜+T}" -->
      <!--                  FontSize="11" -->
      <!--                  VerticalAlignment="Center" -->
      <!--                  Foreground="{DynamicResource MenuFlyoutItemKeyboardAcceleratorTextForeground}"/> -->
      <!--     </StackPanel> -->
      <!--   </ToolTip.Tip> -->
      <!-- -->
      <!--   <Path Width="12" Height="12" Data="{StaticResource Icons.Plus}"/> -->
      <!-- </Button> -->
    </StackPanel>
  </Grid>
</UserControl>
