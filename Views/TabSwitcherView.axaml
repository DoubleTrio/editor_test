<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:m="using:AvaloniaTest.DataModel"
             xmlns:local="clr-namespace:AvaloniaTest.Converters"
             xmlns:vm="using:AvaloniaTest.ViewModels"
             xmlns:c="using:AvaloniaTest.Converters"
             xmlns:v="using:AvaloniaTest.Views"
             x:DataType="vm:TabSwitcherViewModel"
             mc:Ignorable="d" d:DesignWidth="420" d:DesignHeight="200"
             x:Class="AvaloniaTest.Views.TabSwitcherView">
    <Design.DataContext>
        <vm:TabSwitcherViewModel />
    </Design.DataContext>

    <UserControl.Resources>
        <local:IconKeyToGeometryConverter x:Key="IconKeyConverter"/>
        <DataTemplate x:Key="NodeContentTemplate" DataType="vm:NodeBase">
            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="4">
                <Path IsVisible="{Binding Icon, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                      Width="16" Height="16"
                      Data="{Binding Icon, Converter={StaticResource IconKeyConverter}}"/>
                <TextBlock Grid.Column="1"
                           VerticalAlignment="Center"
                           Text="{Binding Title}"
                           TextTrimming="CharacterEllipsis"
                           TextWrapping="NoWrap"
                           ClipToBounds="True" />
            </Grid>
        </DataTemplate>
    </UserControl.Resources>
    <Grid RowDefinitions="Auto, Auto">
        <TextBox Grid.Row="0"
                 Height="24"
                 MaxWidth="420"
                 Margin="4,8,4,0"
                 BorderThickness="1"
                 CornerRadius="12"
                 Watermark="Search for tabs..."
                 Text="{Binding SearchFilter, Mode=TwoWay}"
                 KeyDown="OnSearchBoxKeyDown"
                 BorderBrush="{DynamicResource Brush.Border2}"
                 VerticalContentAlignment="Center">
            <!-- v:AutoFocusBehaviour.IsEnabled="True" -->
            <TextBox.InnerLeftContent>
                <Path
                    Fill="{DynamicResource Brush.FG2}"
                    Width="14" Height="14"
                    Margin="0,1,0,0"
                    Data="{StaticResource Icons.MagnifyingGlassFill}" />
            </TextBox.InnerLeftContent>

            <TextBox.InnerRightContent>
                <Button Classes="icon_button"
                        Width="16"
                        Margin="0,0,6,0"
                        Command="{Binding ClearFilter}"
                        IsVisible="{Binding SearchFilter, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                        HorizontalAlignment="Right">

                    <!-- TODO: Set brush to FG1 -->
                    <Path
                        Width="14" Height="14"
                        Margin="0,1,0,0"
                        Data="{StaticResource Icons.XCircleFill}" />
                </Button>
            </TextBox.InnerRightContent>
        </TextBox>
        <TreeView Grid.Row="1" Margin="0"
                  ItemsSource="{Binding _mainWindow.TopLevelPages}"
                  SelectionMode="Single"
                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled">

            <TreeView.Styles>

                <Style Selector="TreeViewItem" x:DataType="vm:NodeBase">
                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                    <Setter Property="IsVisible" Value="{Binding IsVisible}" />
                    <Setter Property="Padding" Value="4" />
                    <Setter Property="FontSize" Value="14" />
                    <Setter Property="MinHeight" Value="20" />
                </Style>
            </TreeView.Styles>

            <TreeView.DataTemplates>
                <!-- OpenEditorNode -->

                <TreeDataTemplate DataType="vm:PageNode" ItemsSource="{Binding SubNodes}">
                    <Grid ColumnDefinitions="*, Auto">
                        <ContentPresenter Content="{Binding}"
                                          ContentTemplate="{StaticResource NodeContentTemplate}" />
                        <ContentControl />
                    </Grid>
                </TreeDataTemplate>
            </TreeView.DataTemplates>
        </TreeView>


    </Grid>
</UserControl>


<!-- <ListBox Grid.Row="2" -->
<!--          x:Name="PagesListBox" -->
<!--          Width="400" -->
<!--          MaxHeight="400" -->
<!--          Margin="4,8,4,0" -->
<!--          BorderThickness="0" -->
<!--          SelectionMode="Single" -->
<!--          Background="Transparent" -->
<!--          Focusable="True" -->
<!--          ScrollViewer.HorizontalScrollBarVisibility="Disabled" -->
<!--          ScrollViewer.VerticalScrollBarVisibility="Auto" -->
<!--          ItemsSource="{Binding VisiblePages, Mode=OneWay}" -->
<!--          SelectedItem="{Binding SelectedPage, Mode=TwoWay}"> -->
<!--   <ListBox.Styles> -->
<!--     <Style Selector="ListBoxItem"> -->
<!--       <Setter Property="Padding" Value="8,0"/> -->
<!--       <Setter Property="MinHeight" Value="26"/> -->
<!--       <Setter Property="CornerRadius" Value="4"/> -->
<!--     </Style> -->
<!-- -->
<!--     <Style Selector="ListBox"> -->
<!--       <Setter Property="FocusAdorner"> -->
<!--         <FocusAdornerTemplate> -->
<!--           <Grid/> -->
<!--         </FocusAdornerTemplate> -->
<!--       </Setter> -->
<!--     </Style> -->
<!--   </ListBox.Styles> -->
<!-- -->
<!--   <ListBox.ItemsPanel> -->
<!--     <ItemsPanelTemplate> -->
<!--       <StackPanel Orientation="Vertical"/> -->
<!--     </ItemsPanelTemplate> -->
<!--   </ListBox.ItemsPanel> -->
<!-- -->
<!--   <ListBox.ItemTemplate> -->
<!--     <DataTemplate DataType="vm:EditorPageViewModel"> -->
<!--       <Grid ColumnDefinitions="Auto,6,*" Background="Transparent" Tapped="OnItemTapped"> -->
<!--         ~1~ <Path Grid.Column="0" @1@ -->
<!--         ~1~       Width="12" Height="12" @1@ -->
<!--         ~1~       Fill="{Binding Node.Bookmark, Converter={x:Static c:IntConverters.ToBookmarkBrush}}" @1@ -->
<!--         ~1~       Data="{StaticResource Icons.Bookmark}" @1@ -->
<!--         ~1~       IsVisible="{Binding Node.IsRepository}" @1@ -->
<!--         ~1~       IsHitTestVisible="False"/> @1@ -->
<!--         ~1~ <Path Grid.Column="0" @1@ -->
<!--         ~1~       Width="12" Height="12" @1@ -->
<!--         ~1~       Fill="{DynamicResource Brush.FG1}" @1@ -->
<!--         ~1~       Data="{StaticResource Icons.Repositories}" @1@ -->
<!--         ~1~       IsVisible="{Binding !Node.IsRepository}" @1@ -->
<!--         ~1~       IsHitTestVisible="False"/> @1@ -->
<!--         <TextBlock Grid.Column="2" -->
<!--                    Classes="primary" -->
<!--                    VerticalAlignment="Center" -->
<!--                    Text="{Binding Title}" -->
<!--                    IsHitTestVisible="False"/> -->
<!--         ~1~ IsVisible="{Binding Node.IsRepository}" @1@ -->
<!--         ~1~ <TextBlock Grid.Column="2" @1@ -->
<!--         ~1~            Classes="primary" @1@ -->
<!--         ~1~            VerticalAlignment="Center" @1@ -->
<!--         ~1~            Text="{DynamicResource Text.PageTabBar.Welcome.Title}" @1@ -->
<!--         ~1~            IsVisible="{Binding !Node.IsRepository}" @1@ -->
<!--         ~1~            IsHitTestVisible="False"/> @1@ -->
<!--       </Grid> -->
<!--     </DataTemplate> -->
<!--   </ListBox.ItemTemplate> -->
<!-- </ListBox> -->